- hosts: localhost

  tasks:
 
  - name: pwd value
    command: pwd
    register: result
    
  - debug:
      var: result
    
  - name: Get repository
    git:
      repo: 'https://github.com/toharikr/project.git'
      dest: $(Build.SourcesDirectory)

  - include_vars: $(Build.SourcesDirectory)/env.yml
  - debug: msg="Hello, {{ name }}!"
 
  - name: ansible create directory example
    file:
      path: ~/.azure
      state: directory
  - copy:
      src: $(Build.SourcesDirectory)/credentials
      dest: ~/.azure 
      
  - name: Create resource group
    azure_rm_resourcegroup:
        name: demorg
        location: eastus
    register: rg
  - debug:
        var: rg
        
  - name: Create resource group    
    openssh_keypair:
       path: /tmp/id_ssh_rsa
    register: res
  - debug: var1=res 
  
  - name: Create a managed Azure Container Services (AKS) instance
    azure_rm_aks:
      name: myAKS
      location: eastus
      resource_group: myResourceGroup
      dns_prefix: akstest
      kubernetes_version: 1.14.6
    linux_profile:
      admin_username: azureuser
      ssh_key: ssh-rsa $(var1)
    service_principal:
      client_id: "cf72ca99-f6b9-4004-b0e0-bee10c521948"
      client_secret: "mySPNp@ssw0rd!"
    agent_pool_profiles:
      - name: default
        count: 1
        vm_size: Standard_D2_v2
    tags:
      Environment: dev
